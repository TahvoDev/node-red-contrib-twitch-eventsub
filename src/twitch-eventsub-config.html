<script type="text/javascript">
  RED.nodes.registerType('twitch-eventsub-config', {
    category: 'config',
    defaults: {
      name: { value: '', required: true },
      broadcaster_id: { required: true, validate: RED.validators.number() },
      twitch_client_id: { required: true },
      twitch_client_secret: { required: true },
      twitch_refresh_token: { required: true },
      local_websocket_url: { required: false },
      // /**/port: { required: true, validate: RED.validators.number() },
      // /**/eventsub_secret: { required: true },
      // /**/ngrok_token: { required: true },
    },
    inputs: 0,
    outputs: 1,
    label: function() {
      return this.name;
    },
  });
</script>

<style>
  .red-ui-editor .form-row label, .red-ui-editor-dialog .form-row label {
    width: 130px;
  }
  .twitch-eventsub-config-form a {
    color: #55aaea;
    text-decoration: underline;
  }
  .twitch-eventsub-config-form a:hover {
    text-decoration: underline;
  }
</style>

<script type="text/html" data-template-name="twitch-eventsub-config">
    <div class="twitch-eventsub-config-form">
        <div class="form-row">
            <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
            <input type="text" id="node-config-input-name" placeholder="Name">
        </div>

    <!--    <div class="form-row">-->
    <!--        <label for="node-config-input-port"><i class="fa fa-tag"></i> Server Port</label>-->
    <!--        <input type="text" id="node-config-input-port" placeholder="4000">-->
    <!--    </div>-->

        <div class="form-row">
            <label for="node-config-input-broadcaster_id"><i class="fa fa-tag"></i> Twitch Broadcaster ID</label>
            <input type="text" id="node-config-input-broadcaster_id" placeholder="ex: 86587418">

            <p>You can get your user id with the <a href="https://www.streamweasels.com/tools/convert-twitch-username-to-user-id/">Twitch Channel ID and User ID Convertor</a>.</p>
        </div>

        <div class="form-row">
            <label for="node-config-input-twitch_client_id"><i class="fa fa-tag"></i> Twitch Client ID</label>
            <input type="text" id="node-config-input-twitch_client_id" placeholder="ex: cnhszfrw4vbin9pziisb86oe9gsqds">
        </div>

        <div class="form-row">
            <label for="node-config-input-twitch_client_secret"><i class="fa fa-lock"></i> Twitch Client Secret</label>
            <input type="password" id="node-config-input-twitch_client_secret" placeholder="">
        </div>

        <div class="form-row">
            <label for="node-config-input-twitch_refresh_token"><i class="fa fa-lock"></i> Twitch Refresh Token</label>
            <input type="password" id="node-config-input-twitch_refresh_token" placeholder="">
        </div>

        <p>
            To generate the Refresh Token, use the
            <a target="_blank" rel="noreferrer" href="https://dev.twitch.tv/docs/authentication/getting-tokens-oauth/#authorization-code-grant-flow">Authorization code grant flow</a>
            with the following scopes :
        </p>
        <ul>
            <li>bits:read</li>
            <li>channel:moderate</li>
            <li>channel:read:ads</li>
            <li>channel:read:charity</li>
            <li>channel:read:goals</li>
            <li>channel:read:guest_star</li>
            <li>channel:read:hype_train</li>
            <li>channel:read:polls</li>
            <li>channel:read:predictions</li>
            <li>channel:read:redemptions</li>
            <li>channel:read:subscriptions</li>
            <li>channel:read:vips</li>
            <li>chat:read</li>
            <li>moderation:read</li>
            <li>moderator:manage:blocked_terms</li>
            <li>moderator:manage:chat_messages</li>
            <li>moderator:manage:unban_requests</li>
            <li>moderator:read:automod_settings</li>
            <li>moderator:read:blocked_terms</li>
            <li>moderator:read:chat_settings</li>
            <li>moderator:read:followers</li>
            <li>moderator:read:guest_star</li>
            <li>moderator:read:shield_mode</li>
            <li>moderator:read:shoutouts</li>
            <li>moderator:read:suspicious_users</li>
            <li>moderator:read:unban_requests</li>
            <li>user:read:chat</li>
        </ul>
        <p>
            You can use the
            <a target="_blank" rel="noreferrer" href="https://twitchtokengenerator.com/">
                Twitch Token Generator App
            </a>
            to generate this token.

            <ol>
                <li>Go to <a target="_blank" rel="noreferrer" href="https://twitchtokengenerator.com/quick/PA1ezknPc8">this Quicklink</a>.</li>
                <li>Click on "Custom bot token"</li>
                <li>(Optionnal) Fill in your <strong>Client secret</strong> and <strong>Client ID</strong></li>
                <li>All the required scopes should have been pre-selected</li>
                <li>Click on "Generate Token!" at the end of the page</li>
                <li>Authorize the app within Twitch</li>
                <li>Copy the generated Refresh Token</li>
            </ol>
        </p>

        <p>
          Enable to use a local WebSocket with <a href="https://dev.twitch.tv/docs/cli/webscokets-event-command/" target="_blank">Twitch CLI</a>.
          <br/>Only for local testing. If enabled, normal events will not work!
        </p>

        <div class="form-row">
          <label for="node-input-local_websocket_url">
            <i class="fa fa-link"></i> Local WebSocket URL
          </label>
          <input type="text" id="node-input-local_websocket_url" placeholder="ws://localhost:8080/ws">
        </div>

        <p>
            The Twitch logo is the property of Twitch Interactive, Inc.
            Its use is subject to Twitch's brand guidelines and terms of service. <br/>
            For more information, please visit the Twitch website.
        </p>
    </div>
</script>
