<script type="text/javascript">
  RED.nodes.registerType('twitch-eventsub-channel-chat-message', {
    category: 'twitch events',
    color: '#b9a3e3',
    defaults: {
      name: { value: '' },
      config: { type: 'twitch-api-config', required: true },
    },
    inputs: 0,
    outputs: 1,
    icon: 'twitch-icon.png',
    label: function () {
      return this.name || 'chat message';
    },
    paletteLabel: 'chat message',
    labelStyle: function () {
      return this.name ? 'node_label_italic' : '';
    },
    oneditprepare: function () {
      $('#node-input-name').on('input', function () {
        $('#node-input-label').val($(this).val());
      });
    },
  });
</script>

<script type="text/html" data-template-name="twitch-eventsub-channel-chat-message">
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Name" />
  </div>
  <div class="form-row">
    <label for="node-input-config"><i class="fa fa-cog"></i> Twitch Config</label>
    <input type="text" id="node-input-config" />
  </div>
</script>

<script type="text/html" data-help-name="twitch-eventsub-channel-chat-message">
  <p>Triggers when a chat message is sent to the configured Twitch channel.</p>
  <p>The message object contains the following properties from the Twitch EventSub API:</p>
  <h3>Message Identification</h3>
  <ul>
    <li><code>messageId</code>: The unique ID of the message</li>
    <li><code>messageText</code>: The text content of the message</li>
    <li><code>messageType</code>: The type of message (e.g., 'chat', 'whisper')</li>
    <li><code>messageParts</code>: Array of message parts (for messages with emotes, badges, etc.)</li>
  </ul>

  <h3>Chatter Information</h3>
  <ul>
    <li><code>chatterId</code>: The ID of the user who sent the message</li>
    <li><code>chatterName</code>: The login name of the user</li>
    <li><code>chatterDisplayName</code>: The display name of the user</li>
    <li><code>color</code>: The user's chat color</li>
    <li><code>badges</code>: Object containing the user's badges</li>
  </ul>

  <h3>Broadcaster Information</h3>
  <ul>
    <li><code>broadcasterId</code>: The ID of the channel where the message was sent</li>
    <li><code>broadcasterName</code>: The login name of the channel</li>
    <li><code>broadcasterDisplayName</code>: The display name of the channel</li>
  </ul>

  <h3>Message Metadata</h3>
  <ul>
    <li><code>isCheer</code>: Whether the message contains bits</li>
    <li><code>bits</code>: Number of bits cheered, if any</li>
    <li><code>isRedemption</code>: Whether the message represents a reward redemption</li>
    <li><code>isSourceOnly</code>: Whether the message is only sent to the source channel in a shared chat</li>
  </ul>

  <h3>Parent Message (for replies)</h3>
  <ul>
    <li><code>parentMessageId</code>: ID of the parent message</li>
    <li><code>parentMessageText</code>: Text of the parent message</li>
    <li><code>parentMessageUserId</code>: ID of the user who sent the parent message</li>
    <li><code>parentMessageUserName</code>: Login name of the user who sent the parent message</li>
    <li><code>parentMessageUserDisplayName</code>: Display name of the user who sent the parent message</li>
  </ul>

  <h3>Reward Information</h3>
  <ul>
    <li><code>rewardId</code>: ID of the redeemed reward, if applicable</li>
  </ul>

  <h3>Source Information (for shared chat)</h3>
  <ul>
    <li><code>sourceBadges</code>: Badges from the source channel</li>
    <li><code>sourceBroadcasterId</code>: ID of the source broadcaster</li>
    <li><code>sourceBroadcasterName</code>: Login name of the source broadcaster</li>
    <li><code>sourceBroadcasterDisplayName</code>: Display name of the source broadcaster</li>
    <li><code>sourceMessageId</code>: ID of the message in the source channel</li>
  </ul>

  <h3>Thread Information</h3>
  <ul>
    <li><code>threadMessageId</code>: ID of the thread starter message</li>
    <li><code>threadMessageUserId</code>: ID of the user who started the thread</li>
    <li><code>threadMessageUserName</code>: Login name of the user who started the thread</li>
    <li><code>threadMessageUserDisplayName</code>: Display name of the user who started the thread</li>
  </ul>
  <ul>
    <li><code>rawEvent</code>: The complete raw event data</li>
  </ul>
</script>
