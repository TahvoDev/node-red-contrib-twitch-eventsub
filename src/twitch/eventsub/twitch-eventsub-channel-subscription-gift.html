<script type="text/javascript">
    RED.nodes.registerType('twitch-eventsub-channel-subscription-gift', {
      category: 'twitch events',
      color: '#b9a3e3',
      defaults: {
        name: { value: "" },
        config: { value: "", type: "twitch-api-config", required: true }
      },
      inputs: 0,
      outputs: 1,
      icon: 'twitch-icon.png',
      paletteLabel: "subscription gift",
      label: function() {
        if (this.name) {
          return this.name;
        }
        else {
          var config = RED.nodes.node(this.config);
          return 'subscription gift' + (config ? ' (' + (config.name || '') + ')' : '');
        }
      },
    });
  </script>
  
  <script type="text/html" data-template-name="twitch-eventsub-channel-subscription-gift">
    <div class="form-row">
      <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
    </div>

    <div class="form-row">
      <label for="node-input-config"><i class="fa fa-cog"></i> Config</label>
      <input type="text" id="node-input-config" placeholder="">
    </div>
  </script>
  
  <script type="text/html" data-help-name="twitch-eventsub-channel-subscription-gift">
      <h2>Twitch Channel Subscription Gift</h2>
      <p>Triggers when someone gifts a subscription to another user in your Twitch channel.</p>
  
      <h3>Configuration</h3>
      <ul>
          <li><strong>Name</strong>: Optional name for the node</li>
          <li><strong>Config</strong>: Select your Twitch Eventsub configuration</li>
      </ul>
      
      <h3>Output</h3>
      <p>Emits a message when someone gifts a subscription with the following properties:</p>
      
      <dl class="message-properties">
          <dt>payload <span class="property-type">object</span></dt>
          <dd>
              <ul>
                  <!-- Broadcaster Info -->
                  <li><dt>broadcasterId <i>string</i></dt><dd>Twitch user ID of the channel where the gift was given</dd></li>
                  <li><dt>broadcasterName <i>string</i></dt><dd>Twitch login name of the broadcaster</dd></li>
                  <li><dt>broadcasterDisplayName <i>string</i></dt><dd>Display name of the broadcaster</dd></li>
                  
                  <!-- Gifter Info -->
                  <li><dt>gifterId <i>string</i></dt><dd>Twitch user ID of the gifting user</dd></li>
                  <li><dt>gifterName <i>string</i></dt><dd>Twitch login name of the gifting user</dd></li>
                  <li><dt>gifterDisplayName <i>string</i></dt><dd>Display name of the gifting user</dd></li>
                  
                  <!-- Subscription Details -->
                  <li><dt>tier <i>string</i></dt><dd>Subscription tier (1000, 2000, or 3000)</dd></li>
                  <li><dt>amount <i>number</i></dt><dd>Number of subscriptions gifted</dd></li>
                  <li><dt>cumulativeAmount <i>number | null</i></dt><dd>Total number of gifts the gifter has given (null if anonymous)</dd></li>
                  <li><dt>isAnonymous <i>boolean</i></dt><dd>Whether the gift is anonymous</dd></li>
                  
                  <!-- Raw Event -->
                  <li><dt>rawEvent <i>object</i></dt><dd>Complete event data from Twitch API</dd></li>
              </ul>
          </dd>
      </dl>
      
      <h3>Example Usage</h3>
      <p>To thank someone for gifting subscriptions, connect this node to a function node with code like:</p>
      <pre><code>// Check if the gift is anonymous
if (msg.payload.isAnonymous) {
    msg.payload = {
        message: `Thank you anonymous gifter for ${msg.payload.amount} gift subscriptions!`
    };
} else {
    msg.payload = {
        message: `Thank you ${msg.payload.gifterDisplayName} for ${msg.payload.amount} gift subscriptions!`
    };
}
return msg;</code></pre>
  </script>
